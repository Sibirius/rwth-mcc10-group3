<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Hello Maps"
  			   height="305">
    <Require feature="wave" /> 
  </ModulePrefs>
  <Content type="html">
 	<![CDATA[ 	
 		<head>			
		<script type="text/javascript" src="http://www.google.com/jsapi?key=ABQIAAAAGAP5T4BS8Gn8z_KNdk4MuxQs3QBYDBscCkXn5XVh-PO2erUf9BRLbMyRF04Gc0cJo5xmV5wt1Y7oPQ"></script>
		<script type="text/javascript">
		  	google.load("maps", "2");
		  	
		  	//initialise global vars
		  	var map, movieIcon, foodIcon, drinkIcon, danceIcon;
		  	
		  	//get Content by Tag
		  	//makes to code a little shorter^^
		  	function getCbT(obj, tag){
		  		return obj.getElementsByTagName(tag)[0].childNodes[0].nodeValue;
		  	}
		  	
		    function loadMarkers() {    
		    	var params = {};  
		        params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.DOM;  
		        var url = "http://rwth-mcc10-group3.googlecode.com/svn/trunk/abendplaner/gadgets/locationdb.xml";  
		        gadgets.io.makeRequest(url, response, params);
		    };
		    
		    function response(obj) { 
			    var domdata = obj.data;
				var x=domdata.getElementsByTagName("location");
				var point, infoHtml;
		        for (var i = 0; i<x.length ;i++){
		        	infoHtml = "<h5>" + getCbT(x[i],"name") + "</h5>";
		        	if(getCbT(x[i],"eat") == "1") {
		        		point = new GMarker(new GLatLng(getCbT(x[i],"lat"), getCbt(x[i],"lng")), foodIcon);
						GEvent.addListener(point, "click", function() {point.openInfoWindowHtml(infoHtml)} );
						map.addOverlay(point);
					}
		        	if(getCbt(x[i],"dance") == "1") {
		        		point = new GMarker(new GLatLng(getCbt(x[i],"lat"), getCbt(x[i],"lng")), danceIcon);
						GEvent.addListener(point, "click", function() {point.openInfoWindowHtml(infoHtml)} );
						map.addOverlay(point);
					}
			       	if(getCbt(x[i],"drink") == "1") {
		        		point = new GMarker(new GLatLng(getCbt(x[i],"lat"), getCbt(x[i],"lng")), drinkIcon);
						GEvent.addListener(point, "click", function() {point.openInfoWindowHtml(infoHtml)} );
						map.addOverlay(point);
					}
		        	if(getCbt(x[i],"cinema") == "1") {
		        		point = new GMarker(new GLatLng(getCbt(x[i],"lat"), getCbt(x[i],"lng")), movieIcon);
						GEvent.addListener(point, "click", function() {point.openInfoWindowHtml(infoHtml)} );
						map.addOverlay(point);
					}
					
				}			    
			}	    
		  
		    function initMap() {
		  		if(GBrowserIsCompatible()){
			  		//create Google Map centered on Aachen
				    map = new google.maps.Map2(document.getElementById("map"));
				    map.setCenter(new GLatLng(50.77788,6.07826),13);
					map.setUIToDefault();
					
					//Define MovieIcon				
					movieIcon = new GIcon();
					movieIcon.image = "http://rwth-mcc10-group3.googlecode.com/svn/trunk/abendplaner/war/WEB-INF/film-reel-icon.png";
					movieIcon.shadow = "http://rwth-mcc10-group3.googlecode.com/svn/trunk/abendplaner/war/WEB-INF/film-reel-icon-shadow.png";
					movieIcon.iconSize = new GSize(32, 32);
					movieIcon.shadowSize = new GSize(46, 33);
					movieIcon.iconAnchor = new GPoint(16, 16);
					movieIcon.infoWindowAnchor = new GPoint(10, 1);
	
					//Define FoodIcon		
					foodIcon = new GIcon();
					foodIcon.image = "http://rwth-mcc10-group3.googlecode.com/svn/trunk/abendplaner/war/WEB-INF/hamburger-icon.png";
					foodIcon.shadow = "http://rwth-mcc10-group3.googlecode.com/svn/trunk/abendplaner/war/WEB-INF/hamburger-icon-shadow.png";
					foodIcon.iconSize = new GSize(32, 32);
					foodIcon.shadowSize = new GSize(53, 36);
					foodIcon.iconAnchor = new GPoint(16, 16);
					foodIcon.infoWindowAnchor = new GPoint(10, 1);
	 				
					//Define DrinkIcon		  				
	  				drinkIcon = new GIcon();
					drinkIcon.image = "http://rwth-mcc10-group3.googlecode.com/svn/trunk/abendplaner/war/WEB-INF/soft-drink-icon.png";
					drinkIcon.shadow = "http://rwth-mcc10-group3.googlecode.com/svn/trunk/abendplaner/war/WEB-INF/soft-drink-icon-shadow.png";
					drinkIcon.iconSize = new GSize(32, 32);
					drinkIcon.shadowSize = new GSize(51, 37);
					drinkIcon.iconAnchor = new GPoint(16, 16);
					drinkIcon.infoWindowAnchor = new GPoint(10, 1);
	
					//Define danceIcon		
					danceIcon = new GIcon();
					danceIcon.image = "http://rwth-mcc10-group3.googlecode.com/svn/trunk/abendplaner/war/WEB-INF/vinyl-icon.png";
					danceIcon.shadow = "http://rwth-mcc10-group3.googlecode.com/svn/trunk/abendplaner/war/WEB-INF/vinyl-icon-shadow.png";
					danceIcon.iconSize = new GSize(32, 32);
					danceIcon.shadowSize = new GSize(52, 36);
					danceIcon.iconAnchor = new GPoint(16, 16);
					danceIcon.infoWindowAnchor = new GPoint(10, 1);
	
					//define some markers
	  				var movieMarker = new GMarker(new GLatLng(50.75788,6.07826), movieIcon);		
	  				var foodMarker = new GMarker(new GLatLng(50.77788,6.07826), foodIcon);				
	  				var drinkMarker = new GMarker(new GLatLng(50.78788,6.07826), drinkIcon);				
	  				var danceMarker = new GMarker(new GLatLng(50.76788,6.07826), danceIcon);
	
					map.addOverlay(movieMarker);
					map.addOverlay(foodMarker);
					map.addOverlay(drinkMarker);
					map.addOverlay(danceMarker);
					
					loadMarkers();
				}
			}
		</script>    
  		</head>
  		<body onload="initMap()">
    	  <div id="map" style="width: 100%; height: 300px"></div>  
		</body>
		
    ]]>
  </Content>
</Module>