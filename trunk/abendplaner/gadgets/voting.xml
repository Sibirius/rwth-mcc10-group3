<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
<ModulePrefs title="Abendplaner Voting" height="120">
  <Require feature="wave" /> 
</ModulePrefs>
<Content type="html">
<![CDATA[
	<script>
		function init() {
		    var params = {};  
		    params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.DOM;  
		    var url = "http://rwth-mcc10-group3.googlecode.com/svn/trunk/abendplaner/gadgets/locationdb.xml";  
		    gadgets.io.makeRequest(url, response, params);
		}
		
		function response(obj){
			var domdata = obj.data;
			var x=domdata.getElementsByTagName("location");
		    for (var i = 0; i<x.length ;i++){
				insertNewChoice( createVoteElement( x[i].getElementsByTagName("name")[0].childNodes[0].nodeValue, i) );		    
		    }		
		}
		
		// creates element with label and yes/no choice
		function createVoteElement(text, number) {
			var p = document.createElement("p");
		
			var select = document.createElement("select");
	
			var ja = document.createElement("option");
			ja.appendChild(document.createTextNode("yes"));
			var nein = document.createElement("option");
			nein.appendChild(document.createTextNode("nein"));

			select.appendChild(ja);
			select.appendChild(nein);			

			p.appendChild(document.createTextNode(text));
			p.appendChild(select);

			return p;
		}
				
		// inserts before button after all the other choices
		function insertNewChoice(choice) {
			var vc = document.getElementById("voting_container");
			var vb = document.getElementById("voting_btn");

			vc.insertBefore(choice, vb); 
			 
		}

		//TODO: proper submit action, generate onload, not on click
	</script>

	<form action="javascript:return;" id="voting_container">
		<input id="voting_btn" type="button" value="Vote!" onclick="init()"/>
	</div>
  ]]> 
  </Content>
</Module>